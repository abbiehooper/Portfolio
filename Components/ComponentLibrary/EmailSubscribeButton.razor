<div class="d-flex align-center gap-0 width-500 mb-8">
    <MudTextField @bind-Value="email"
                  Variant="Variant.Outlined"
                  Placeholder="Enter your email"
                  InputType="InputType.Email"
                  Immediate="true"
                  Validation="() => ValidateEmail" />
    <MudButton Variant="Variant.Filled"
               Color="Color.Primary"
               Size="Size.Large"
               class="rounded-pill"
               Disabled="@(string.IsNullOrWhiteSpace(email) || !IsValidEmail(email) || isSubscribing)"
               OnClick="Subscribe">
        @if (isSubscribing)
        {
            <span>Subscribing </span>

            <MudProgressCircular Size="Size.Small" Indeterminate="true" />
        }
        else
        {
            <span>Subscribe</span>
        }
    </MudButton>
</div>

@code {
    [Inject] public required ISnackbar Snackbar { get; set; }

    private string email = "";
    private bool isSubscribing = false;

    private async Task Subscribe()
    {
        if (string.IsNullOrWhiteSpace(email) || !IsValidEmail(email))
        {
            Snackbar.Add("Please enter a valid email address.", Severity.Warning);
            return;
        }

        isSubscribing = true;

        try
        {
            // Simulate subscription process
            await Task.Delay(1500);

            Snackbar.Add($"Successfully subscribed {email} to our newsletter!", Severity.Success);
            email = ""; // Clear the input
        }
        catch (Exception)
        {
            Snackbar.Add("Failed to subscribe. Please try again later.", Severity.Error);
        }
        finally
        {
            isSubscribing = false;
        }
    }

    private bool IsValidEmail(string email)
    {
        try
        {
            var addr = new System.Net.Mail.MailAddress(email);
            return addr.Address == email;
        }
        catch
        {
            return false;
        }
    }

    private string ValidateEmail(string email)
    {
        if (string.IsNullOrWhiteSpace(email))
            return "Email is required";

        if (!IsValidEmail(email))
            return "Please enter a valid email address";

        return "";
    }
}